# Back End Vezdecode Final

Сервис написан на Node Js + MySQL
Ниже описана подробная информация по кажому шагу из задания.

## Шаг 1 (на 10 баллов)

Код сервиса находится в файле ```server.js```
Get запрос на получение изображения по ID
```
(Get) http://137.184.70.55/get?id=1
```

Post запрос на загрузку изображения
```
(Post) http://137.184.70.55/step1/upload
Обязательный параметр file (form data)
```

## Шаг 2 (на 20 баллов)

Создан докер образ и в файле docker-compose.yml передаются адрес и порт сервиса
```
EXPRESS_PORT: 80
EXPRESS_HOST: 0.0.0.0
```

Кусок Node JS кода, который принимает эти параметры:
```
var port = process.env.EXPRESS_PORT || "80";
var host = process.env.EXPRESS_HOST || '0.0.0.0';
```
	
## Шаг 3 (на 30 баллов)

Реализован параметр scale, которые регулирует размер картинки:
* http://137.184.70.55/get?id=1&scale=0.2
* http://137.184.70.55/get?id=1&scale=1.5
	
## Шаг 4 (на 40 баллов)

Основной код сервиса находится в файле ```server.js```

Через алгоритм Perceptual Hashing (алгоритм находится в файле ```hash_bit.js```) реализовано хеширование картинок. Хеш сохраняется в базе MySQL. Хеш считается равным, если levenshtein_ratio больше или равно 90%

Post запрос на загрузку изображения
```
(Post) http://137.184.70.55/upload
Обязательный параметр file (form data)
Необязательный параметр thresholdSimilarity, он по умочанию равен 90
```

## Шаг 5 (на 50 баллов)

В каталоге ```test_images``` хранятся примеры пар изображений для теста. Они охватывают все состояния, которые требовалось обработать при поиске и сохранении изображений.

Ниже приведены ответы сервера при последовательной загрузке изображений.
```
Тестируем односторонний кроп:
test_images/1/tiger_1.jpeg - Изображение успешно добавлено
test_images/1/tiger_2_crop.jpg - Изображение успешно добавлено. Оно было в базе, но с другим соотношением сторон

Тестируем уменьшение ширины:
test_images/2/nature_1.jpeg - Изображение успешно добавлено
test_images/2/nature_2_different_ratio.jpg - Изображение успешно добавлено. Оно было в базе, но с другим соотношением сторон

Тестируем пропорциональное увеличение размера:
test_images/3/room_1.jpeg - Изображение успешно добавлено
test_images/3/room_2_scale_up.jpg - Изображение успешно заменено, так как размер стал больше

Тестируем водяной знак на изображении:
test_images/4/space_1.jpeg - Изображение успешно добавлено
test_images/4/space_2_watermark.jpg - Изображение уже существует
```

В задании не было указано по какой метрике должна считаться схожесть. У меня в сервисе используется расстояние Левенштейна. Поэтому в запрос ```upload``` был добавлен параметр thresholdSimilarity - для подгонки порогового значения.

